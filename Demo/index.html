<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG 橫向滾動 </title>
    <style>
        body, html {
            margin: 0; padding: 0; overflow: hidden; height: 100%; background-color: #87CEEB;
        }
        #game-viewport {
            position: relative; width: 100vw; height: 100vh; overflow: hidden;
        }
        #world-layer {
            position: absolute; top: 0; left: 0; height: 100%; display: flex;
            will-change: transform; transition: transform 0.1s ease-out;
        }
        .scene {
            width: 100vw; height: 100%; flex-shrink: 0; display: flex;
            justify-content: center; align-items: center; font-size: 3rem; color: white;
            font-weight: bold; border-right: 5px solid rgba(255,255,255,0.3);
        }
        .scene:nth-child(1) { background: linear-gradient(to bottom, transparent 60%, #228B22 60%); }
        .scene:nth-child(2) { background: linear-gradient(to bottom, transparent 55%, #556B2F 55%); }
        .scene:nth-child(3) { background: linear-gradient(to bottom, transparent 65%, #8B4513 65%); }


        #character-container {
            position: absolute;
            bottom: 22%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 100px; /* SVG 寬度 */
            height: 100px; /* SVG 高度 */
        }

        #character-img {
            width: 100%;
            height: auto;
            display: block;
            filter: drop-shadow(0 10px 5px rgba(0,0,0,0.3));
        }

        #series-toggle {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 20;
            padding: 10px 16px;
            border-radius: 999px;
            border: none;
            background: rgba(0, 0, 0, 0.75);
            color: #fff;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }

        #series-toggle:hover {
            background: rgba(0, 0, 0, 0.9);
        }

    </style>
</head>
<body>

    <div id="game-viewport">
        <div id="world-layer">
            <div class="scene">sence 1</div>
            <div class="scene">sence 2</div>
            <div class="scene">sence 3</div>
        </div>

        <div id="character-container">
            <img id="character-img" src="" alt="Character">
        </div>
    </div>

    <button id="series-toggle" type="button">切換到可愛系列</button>

    <script>
        const seriesOptions = [
            { label: '一般系列', suffix: '' },
            { label: '可愛系列', suffix: '_cute' }
        ];

        let currentSeriesIndex = 1;
        let svgFrames = buildFrames(seriesOptions[currentSeriesIndex].suffix);

        function buildFrames(suffix) {
            return [
                `image/Walk1${suffix}.svg`,
                `image/Walk2${suffix}.svg`,
                `image/Walk3${suffix}.svg`,
                `image/Walk4${suffix}.svg`,
                `image/Walk5${suffix}.svg`,
                `image/Walk6${suffix}.svg`
            ];
        }

        const charImgElement = document.getElementById('character-img');
        const seriesToggleButton = document.getElementById('series-toggle');
        function preloadFrames(frames) {
            frames.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }

        preloadFrames(svgFrames);


        let currentFrameIndex = 0; // 目前播到第幾張
        let animationInterval = null; // 用來存放 setInterval 的變數
        let isWalking = false; // 狀態標記：是否正在走路中

        function playNextFrame() {
            // 索引 +1，並使用取餘數 (%) 確保在 0 到 5 之間循環
            currentFrameIndex = (currentFrameIndex + 1) % svgFrames.length;
            // 切換圖片來源
            charImgElement.src = svgFrames[currentFrameIndex];
        }

        function startWalking() {
            if (isWalking) return;
            isWalking = true;
            
            animationInterval = setInterval(playNextFrame, 100);
        }

        function stopWalking() {
            if (!isWalking) return;
            isWalking = false;
            clearInterval(animationInterval);
            animationInterval = null;
            currentFrameIndex = 0;
            charImgElement.src = svgFrames[0];
        }

        function setSeries(index) {
            currentSeriesIndex = index;
            svgFrames = buildFrames(seriesOptions[currentSeriesIndex].suffix);
            preloadFrames(svgFrames);
            currentFrameIndex = 0;
            charImgElement.src = svgFrames[0];
            seriesToggleButton.textContent = `切換到${seriesOptions[(currentSeriesIndex + 1) % seriesOptions.length].label}`;
        }

        seriesToggleButton.addEventListener('click', () => {
            const nextIndex = (currentSeriesIndex + 1) % seriesOptions.length;
            setSeries(nextIndex);
        });

        setSeries(currentSeriesIndex);

        const worldLayer = document.getElementById('world-layer');
        let currentScrollX = 0;
        let maxScrollX = worldLayer.offsetWidth - window.innerWidth;
        let stopScrollingTimer = null;

        window.addEventListener('wheel', (e) => {
            e.preventDefault();

            currentScrollX += e.deltaY * 0.7;
            currentScrollX = Math.max(0, Math.min(currentScrollX, maxScrollX));
            worldLayer.style.transform = `translateX(-${currentScrollX}px)`;

            startWalking();

            if (stopScrollingTimer !== null) {
                clearTimeout(stopScrollingTimer);
            }

            stopScrollingTimer = setTimeout(() => {
                stopWalking();
            }, 150);

        }, { passive: false });

        window.addEventListener('resize', () => {
             maxScrollX = worldLayer.offsetWidth - window.innerWidth;
        });

    </script>
</body>
</html>
